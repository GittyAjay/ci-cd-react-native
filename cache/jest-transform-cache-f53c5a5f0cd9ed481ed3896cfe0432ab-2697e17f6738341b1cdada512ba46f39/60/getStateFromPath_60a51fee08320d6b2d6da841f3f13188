6737cd1433dd89f8fbebf022d432a6be
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getStateFromPath;

var _escapeStringRegexp = _interopRequireDefault(require("escape-string-regexp"));

var queryString = _interopRequireWildcard(require("query-string"));

var _findFocusedRoute = _interopRequireDefault(require("./findFocusedRoute"));

var _validatePathConfig = _interopRequireDefault(require("./validatePathConfig"));

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getStateFromPath(path, options) {
  var _ref;

  if (options) {
    (0, _validatePathConfig.default)(options);
  }

  var initialRoutes = [];

  if (options !== null && options !== void 0 && options.initialRouteName) {
    initialRoutes.push({
      initialRouteName: options.initialRouteName,
      parentScreens: []
    });
  }

  var screens = options === null || options === void 0 ? void 0 : options.screens;
  var remaining = path.replace(/\/+/g, '/').replace(/^\//, '').replace(/\?.*$/, '');
  remaining = remaining.endsWith('/') ? remaining : remaining + "/";

  if (screens === undefined) {
    var _routes = remaining.split('/').filter(Boolean).map(function (segment) {
      var name = decodeURIComponent(segment);
      return {
        name: name
      };
    });

    if (_routes.length) {
      return createNestedStateObject(path, _routes, initialRoutes);
    }

    return undefined;
  }

  var configs = (_ref = []).concat.apply(_ref, (0, _toConsumableArray2.default)(Object.keys(screens).map(function (key) {
    return createNormalizedConfigs(key, screens, [], initialRoutes, []);
  }))).sort(function (a, b) {
    if (a.pattern === b.pattern) {
      return b.routeNames.join('>').localeCompare(a.routeNames.join('>'));
    }

    if (a.pattern.startsWith(b.pattern)) {
      return -1;
    }

    if (b.pattern.startsWith(a.pattern)) {
      return 1;
    }

    var aParts = a.pattern.split('/');
    var bParts = b.pattern.split('/');

    for (var i = 0; i < Math.max(aParts.length, bParts.length); i++) {
      if (aParts[i] == null) {
        return 1;
      }

      if (bParts[i] == null) {
        return -1;
      }

      var aWildCard = aParts[i] === '*' || aParts[i].startsWith(':');
      var bWildCard = bParts[i] === '*' || bParts[i].startsWith(':');

      if (aWildCard && bWildCard) {
        continue;
      }

      if (aWildCard) {
        return 1;
      }

      if (bWildCard) {
        return -1;
      }
    }

    return bParts.length - aParts.length;
  });

  configs.reduce(function (acc, config) {
    if (acc[config.pattern]) {
      var a = acc[config.pattern].routeNames;
      var b = config.routeNames;
      var intersects = a.length > b.length ? b.every(function (it, i) {
        return a[i] === it;
      }) : a.every(function (it, i) {
        return b[i] === it;
      });

      if (!intersects) {
        throw new Error("Found conflicting screens with the same pattern. The pattern '" + config.pattern + "' resolves to both '" + a.join(' > ') + "' and '" + b.join(' > ') + "'. Patterns must be unique and cannot resolve to more than one screen.");
      }
    }

    return Object.assign(acc, (0, _defineProperty2.default)({}, config.pattern, config));
  }, {});

  if (remaining === '/') {
    var match = configs.find(function (config) {
      return config.path === '' && config.routeNames.every(function (name) {
        var _configs$find;

        return !((_configs$find = configs.find(function (c) {
          return c.screen === name;
        })) !== null && _configs$find !== void 0 && _configs$find.path);
      });
    });

    if (match) {
      return createNestedStateObject(path, match.routeNames.map(function (name) {
        return {
          name: name
        };
      }), initialRoutes, configs);
    }

    return undefined;
  }

  var result;
  var current;

  var _matchAgainstConfigs = matchAgainstConfigs(remaining, configs.map(function (c) {
    return Object.assign({}, c, {
      regex: c.regex ? new RegExp(c.regex.source + '$') : undefined
    });
  })),
      routes = _matchAgainstConfigs.routes,
      remainingPath = _matchAgainstConfigs.remainingPath;

  if (routes !== undefined) {
    current = createNestedStateObject(path, routes, initialRoutes, configs);
    remaining = remainingPath;
    result = current;
  }

  if (current == null || result == null) {
    return undefined;
  }

  return result;
}

var joinPaths = function joinPaths() {
  var _ref2;

  for (var _len = arguments.length, paths = new Array(_len), _key = 0; _key < _len; _key++) {
    paths[_key] = arguments[_key];
  }

  return (_ref2 = []).concat.apply(_ref2, (0, _toConsumableArray2.default)(paths.map(function (p) {
    return p.split('/');
  }))).filter(Boolean).join('/');
};

var matchAgainstConfigs = function matchAgainstConfigs(remaining, configs) {
  var routes;
  var remainingPath = remaining;

  var _loop = function _loop(config) {
    if (!config.regex) {
      return "continue";
    }

    var match = remainingPath.match(config.regex);

    if (match) {
      var matchedParams = (_config$pattern = config.pattern) === null || _config$pattern === void 0 ? void 0 : _config$pattern.split('/').filter(function (p) {
        return p.startsWith(':');
      }).reduce(function (acc, p, i) {
        return Object.assign(acc, (0, _defineProperty2.default)({}, p, match[(i + 1) * 2].replace(/\//, '')));
      }, {});
      routes = config.routeNames.map(function (name) {
        var _config$path;

        var config = configs.find(function (c) {
          return c.screen === name;
        });
        var params = config === null || config === void 0 ? void 0 : (_config$path = config.path) === null || _config$path === void 0 ? void 0 : _config$path.split('/').filter(function (p) {
          return p.startsWith(':');
        }).reduce(function (acc, p) {
          var value = matchedParams[p];

          if (value) {
            var _config$parse;

            var key = p.replace(/^:/, '').replace(/\?$/, '');
            acc[key] = (_config$parse = config.parse) !== null && _config$parse !== void 0 && _config$parse[key] ? config.parse[key](value) : value;
          }

          return acc;
        }, {});

        if (params && Object.keys(params).length) {
          return {
            name: name,
            params: params
          };
        }

        return {
          name: name
        };
      });
      remainingPath = remainingPath.replace(match[1], '');
      return "break";
    }
  };

  for (var config of configs) {
    var _config$pattern;

    var _ret = _loop(config);

    if (_ret === "continue") continue;
    if (_ret === "break") break;
  }

  return {
    routes: routes,
    remainingPath: remainingPath
  };
};

var createNormalizedConfigs = function createNormalizedConfigs(screen, routeConfig) {
  var routeNames = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  var initials = arguments.length > 3 ? arguments[3] : undefined;
  var parentScreens = arguments.length > 4 ? arguments[4] : undefined;
  var parentPattern = arguments.length > 5 ? arguments[5] : undefined;
  var configs = [];
  routeNames.push(screen);
  parentScreens.push(screen);
  var config = routeConfig[screen];

  if (typeof config === 'string') {
    var pattern = parentPattern ? joinPaths(parentPattern, config) : config;
    configs.push(createConfigItem(screen, routeNames, pattern, config));
  } else if (typeof config === 'object') {
    var _pattern2;

    if (typeof config.path === 'string') {
      if (config.exact && config.path === undefined) {
        throw new Error("A 'path' needs to be specified when specifying 'exact: true'. If you don't want this screen in the URL, specify it as empty string, e.g. `path: ''`.");
      }

      _pattern2 = config.exact !== true ? joinPaths(parentPattern || '', config.path || '') : config.path || '';
      configs.push(createConfigItem(screen, routeNames, _pattern2, config.path, config.parse));
    }

    if (config.screens) {
      if (config.initialRouteName) {
        initials.push({
          initialRouteName: config.initialRouteName,
          parentScreens: parentScreens
        });
      }

      Object.keys(config.screens).forEach(function (nestedConfig) {
        var _pattern;

        var result = createNormalizedConfigs(nestedConfig, config.screens, routeNames, initials, (0, _toConsumableArray2.default)(parentScreens), (_pattern = _pattern2) !== null && _pattern !== void 0 ? _pattern : parentPattern);
        configs.push.apply(configs, (0, _toConsumableArray2.default)(result));
      });
    }
  }

  routeNames.pop();
  return configs;
};

var createConfigItem = function createConfigItem(screen, routeNames, pattern, path, parse) {
  pattern = pattern.split('/').filter(Boolean).join('/');
  var regex = pattern ? new RegExp("^(" + pattern.split('/').map(function (it) {
    if (it.startsWith(':')) {
      return "(([^/]+\\/)" + (it.endsWith('?') ? '?' : '') + ")";
    }

    return (it === '*' ? '.*' : (0, _escapeStringRegexp.default)(it)) + "\\/";
  }).join('') + ")") : undefined;
  return {
    screen: screen,
    regex: regex,
    pattern: pattern,
    path: path,
    routeNames: (0, _toConsumableArray2.default)(routeNames),
    parse: parse
  };
};

var findParseConfigForRoute = function findParseConfigForRoute(routeName, flatConfig) {
  for (var config of flatConfig) {
    if (routeName === config.routeNames[config.routeNames.length - 1]) {
      return config.parse;
    }
  }

  return undefined;
};

var findInitialRoute = function findInitialRoute(routeName, parentScreens, initialRoutes) {
  for (var config of initialRoutes) {
    if (parentScreens.length === config.parentScreens.length) {
      var sameParents = true;

      for (var i = 0; i < parentScreens.length; i++) {
        if (parentScreens[i].localeCompare(config.parentScreens[i]) !== 0) {
          sameParents = false;
          break;
        }
      }

      if (sameParents) {
        return routeName !== config.initialRouteName ? config.initialRouteName : undefined;
      }
    }
  }

  return undefined;
};

var createStateObject = function createStateObject(initialRoute, route, isEmpty) {
  if (isEmpty) {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, route]
      };
    } else {
      return {
        routes: [route]
      };
    }
  } else {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, Object.assign({}, route, {
          state: {
            routes: []
          }
        })]
      };
    } else {
      return {
        routes: [Object.assign({}, route, {
          state: {
            routes: []
          }
        })]
      };
    }
  }
};

var createNestedStateObject = function createNestedStateObject(path, routes, initialRoutes, flatConfig) {
  var state;
  var route = routes.shift();
  var parentScreens = [];
  var initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
  parentScreens.push(route.name);
  state = createStateObject(initialRoute, route, routes.length === 0);

  if (routes.length > 0) {
    var nestedState = state;

    while (route = routes.shift()) {
      initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
      var nestedStateIndex = nestedState.index || nestedState.routes.length - 1;
      nestedState.routes[nestedStateIndex].state = createStateObject(initialRoute, route, routes.length === 0);

      if (routes.length > 0) {
        nestedState = nestedState.routes[nestedStateIndex].state;
      }

      parentScreens.push(route.name);
    }
  }

  route = (0, _findFocusedRoute.default)(state);
  route.path = path;
  var params = parseQueryParams(path, flatConfig ? findParseConfigForRoute(route.name, flatConfig) : undefined);

  if (params) {
    route.params = Object.assign({}, route.params, params);
  }

  return state;
};

var parseQueryParams = function parseQueryParams(path, parseConfig) {
  var query = path.split('?')[1];
  var params = queryString.parse(query);

  if (parseConfig) {
    Object.keys(params).forEach(function (name) {
      if (Object.hasOwnProperty.call(parseConfig, name) && typeof params[name] === 'string') {
        params[name] = parseConfig[name](params[name]);
      }
    });
  }

  return Object.keys(params).length ? params : undefined;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bWVzIjpbImdldFN0YXRlRnJvbVBhdGgiLCJwYXRoIiwib3B0aW9ucyIsImluaXRpYWxSb3V0ZXMiLCJpbml0aWFsUm91dGVOYW1lIiwicHVzaCIsInBhcmVudFNjcmVlbnMiLCJzY3JlZW5zIiwicmVtYWluaW5nIiwicmVwbGFjZSIsImVuZHNXaXRoIiwidW5kZWZpbmVkIiwicm91dGVzIiwic3BsaXQiLCJmaWx0ZXIiLCJCb29sZWFuIiwibWFwIiwic2VnbWVudCIsIm5hbWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJsZW5ndGgiLCJjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdCIsImNvbmZpZ3MiLCJjb25jYXQiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MiLCJzb3J0IiwiYSIsImIiLCJwYXR0ZXJuIiwicm91dGVOYW1lcyIsImpvaW4iLCJsb2NhbGVDb21wYXJlIiwic3RhcnRzV2l0aCIsImFQYXJ0cyIsImJQYXJ0cyIsImkiLCJNYXRoIiwibWF4IiwiYVdpbGRDYXJkIiwiYldpbGRDYXJkIiwicmVkdWNlIiwiYWNjIiwiY29uZmlnIiwiaW50ZXJzZWN0cyIsImV2ZXJ5IiwiaXQiLCJFcnJvciIsImFzc2lnbiIsIm1hdGNoIiwiZmluZCIsImMiLCJzY3JlZW4iLCJfY29uZmlncyRmaW5kIiwicmVzdWx0IiwiY3VycmVudCIsIm1hdGNoQWdhaW5zdENvbmZpZ3MiLCJyZWdleCIsIlJlZ0V4cCIsInNvdXJjZSIsInJlbWFpbmluZ1BhdGgiLCJqb2luUGF0aHMiLCJwYXRocyIsImFyZ3VtZW50cyIsInAiLCJtYXRjaGVkUGFyYW1zIiwiX2NvbmZpZyRwYXR0ZXJuIiwicGFyYW1zIiwiX2NvbmZpZyRwYXRoIiwidmFsdWUiLCJwYXJzZSIsInJvdXRlQ29uZmlnIiwiaW5pdGlhbHMiLCJwYXJlbnRQYXR0ZXJuIiwiY3JlYXRlQ29uZmlnSXRlbSIsImV4YWN0IiwiZm9yRWFjaCIsIm5lc3RlZENvbmZpZyIsInBvcCIsImZpbmRQYXJzZUNvbmZpZ0ZvclJvdXRlIiwicm91dGVOYW1lIiwiZmxhdENvbmZpZyIsImZpbmRJbml0aWFsUm91dGUiLCJzYW1lUGFyZW50cyIsImNyZWF0ZVN0YXRlT2JqZWN0IiwiaW5pdGlhbFJvdXRlIiwicm91dGUiLCJpc0VtcHR5IiwiaW5kZXgiLCJzdGF0ZSIsInNoaWZ0IiwibmVzdGVkU3RhdGUiLCJuZXN0ZWRTdGF0ZUluZGV4IiwicGFyc2VRdWVyeVBhcmFtcyIsInBhcnNlQ29uZmlnIiwicXVlcnkiLCJxdWVyeVN0cmluZyIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VzIjpbImdldFN0YXRlRnJvbVBhdGgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHtcbiAgSW5pdGlhbFN0YXRlLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcnRpYWxTdGF0ZSxcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5pbXBvcnQgZXNjYXBlIGZyb20gJ2VzY2FwZS1zdHJpbmctcmVnZXhwJztcbmltcG9ydCAqIGFzIHF1ZXJ5U3RyaW5nIGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5cbmltcG9ydCBmaW5kRm9jdXNlZFJvdXRlIGZyb20gJy4vZmluZEZvY3VzZWRSb3V0ZSc7XG5pbXBvcnQgdHlwZSB7IFBhdGhDb25maWdNYXAgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB2YWxpZGF0ZVBhdGhDb25maWcgZnJvbSAnLi92YWxpZGF0ZVBhdGhDb25maWcnO1xuXG50eXBlIE9wdGlvbnM8UGFyYW1MaXN0IGV4dGVuZHMge30+ID0ge1xuICBpbml0aWFsUm91dGVOYW1lPzogc3RyaW5nO1xuICBzY3JlZW5zOiBQYXRoQ29uZmlnTWFwPFBhcmFtTGlzdD47XG59O1xuXG50eXBlIFBhcnNlQ29uZmlnID0gUmVjb3JkPHN0cmluZywgKHZhbHVlOiBzdHJpbmcpID0+IGFueT47XG5cbnR5cGUgUm91dGVDb25maWcgPSB7XG4gIHNjcmVlbjogc3RyaW5nO1xuICByZWdleD86IFJlZ0V4cDtcbiAgcGF0aDogc3RyaW5nO1xuICBwYXR0ZXJuOiBzdHJpbmc7XG4gIHJvdXRlTmFtZXM6IHN0cmluZ1tdO1xuICBwYXJzZT86IFBhcnNlQ29uZmlnO1xufTtcblxudHlwZSBJbml0aWFsUm91dGVDb25maWcgPSB7XG4gIGluaXRpYWxSb3V0ZU5hbWU6IHN0cmluZztcbiAgcGFyZW50U2NyZWVuczogc3RyaW5nW107XG59O1xuXG50eXBlIFJlc3VsdFN0YXRlID0gUGFydGlhbFN0YXRlPE5hdmlnYXRpb25TdGF0ZT4gJiB7XG4gIHN0YXRlPzogUmVzdWx0U3RhdGU7XG59O1xuXG50eXBlIFBhcnNlZFJvdXRlID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHBhdGg/OiBzdHJpbmc7XG4gIHBhcmFtcz86IFJlY29yZDxzdHJpbmcsIGFueT4gfCB1bmRlZmluZWQ7XG59O1xuXG4vKipcbiAqIFV0aWxpdHkgdG8gcGFyc2UgYSBwYXRoIHN0cmluZyB0byBpbml0aWFsIHN0YXRlIG9iamVjdCBhY2NlcHRlZCBieSB0aGUgY29udGFpbmVyLlxuICogVGhpcyBpcyB1c2VmdWwgZm9yIGRlZXAgbGlua2luZyB3aGVuIHdlIG5lZWQgdG8gaGFuZGxlIHRoZSBpbmNvbWluZyBVUkwuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGpzXG4gKiBnZXRTdGF0ZUZyb21QYXRoKFxuICogICAnL2NoYXQvamFuZS80MicsXG4gKiAgIHtcbiAqICAgICBzY3JlZW5zOiB7XG4gKiAgICAgICBDaGF0OiB7XG4gKiAgICAgICAgIHBhdGg6ICdjaGF0LzphdXRob3IvOmlkJyxcbiAqICAgICAgICAgcGFyc2U6IHsgaWQ6IE51bWJlciB9XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICogICB9XG4gKiApXG4gKiBgYGBcbiAqIEBwYXJhbSBwYXRoIFBhdGggc3RyaW5nIHRvIHBhcnNlIGFuZCBjb252ZXJ0LCBlLmcuIC9mb28vYmFyP2NvdW50PTQyLlxuICogQHBhcmFtIG9wdGlvbnMgRXh0cmEgb3B0aW9ucyB0byBmaW5lLXR1bmUgaG93IHRvIHBhcnNlIHRoZSBwYXRoLlxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRTdGF0ZUZyb21QYXRoPFBhcmFtTGlzdCBleHRlbmRzIHt9PihcbiAgcGF0aDogc3RyaW5nLFxuICBvcHRpb25zPzogT3B0aW9uczxQYXJhbUxpc3Q+XG4pOiBSZXN1bHRTdGF0ZSB8IHVuZGVmaW5lZCB7XG4gIGlmIChvcHRpb25zKSB7XG4gICAgdmFsaWRhdGVQYXRoQ29uZmlnKG9wdGlvbnMpO1xuICB9XG5cbiAgbGV0IGluaXRpYWxSb3V0ZXM6IEluaXRpYWxSb3V0ZUNvbmZpZ1tdID0gW107XG5cbiAgaWYgKG9wdGlvbnM/LmluaXRpYWxSb3V0ZU5hbWUpIHtcbiAgICBpbml0aWFsUm91dGVzLnB1c2goe1xuICAgICAgaW5pdGlhbFJvdXRlTmFtZTogb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lLFxuICAgICAgcGFyZW50U2NyZWVuczogW10sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBzY3JlZW5zID0gb3B0aW9ucz8uc2NyZWVucztcblxuICBsZXQgcmVtYWluaW5nID0gcGF0aFxuICAgIC5yZXBsYWNlKC9cXC8rL2csICcvJykgLy8gUmVwbGFjZSBtdWx0aXBsZSBzbGFzaCAoLy8pIHdpdGggc2luZ2xlIG9uZXNcbiAgICAucmVwbGFjZSgvXlxcLy8sICcnKSAvLyBSZW1vdmUgZXh0cmEgbGVhZGluZyBzbGFzaFxuICAgIC5yZXBsYWNlKC9cXD8uKiQvLCAnJyk7IC8vIFJlbW92ZSBxdWVyeSBwYXJhbXMgd2hpY2ggd2Ugd2lsbCBoYW5kbGUgbGF0ZXJcblxuICAvLyBNYWtlIHN1cmUgdGhlcmUgaXMgYSB0cmFpbGluZyBzbGFzaFxuICByZW1haW5pbmcgPSByZW1haW5pbmcuZW5kc1dpdGgoJy8nKSA/IHJlbWFpbmluZyA6IGAke3JlbWFpbmluZ30vYDtcblxuICBpZiAoc2NyZWVucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gV2hlbiBubyBjb25maWcgaXMgc3BlY2lmaWVkLCB1c2UgdGhlIHBhdGggc2VnbWVudHMgYXMgcm91dGUgbmFtZXNcbiAgICBjb25zdCByb3V0ZXMgPSByZW1haW5pbmdcbiAgICAgIC5zcGxpdCgnLycpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAubWFwKChzZWdtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVVUklDb21wb25lbnQoc2VnbWVudCk7XG4gICAgICAgIHJldHVybiB7IG5hbWUgfTtcbiAgICAgIH0pO1xuXG4gICAgaWYgKHJvdXRlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdChwYXRoLCByb3V0ZXMsIGluaXRpYWxSb3V0ZXMpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBDcmVhdGUgYSBub3JtYWxpemVkIGNvbmZpZ3MgYXJyYXkgd2hpY2ggd2lsbCBiZSBlYXNpZXIgdG8gdXNlXG4gIGNvbnN0IGNvbmZpZ3MgPSAoW10gYXMgUm91dGVDb25maWdbXSlcbiAgICAuY29uY2F0KFxuICAgICAgLi4uT2JqZWN0LmtleXMoc2NyZWVucykubWFwKChrZXkpID0+XG4gICAgICAgIGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzKFxuICAgICAgICAgIGtleSxcbiAgICAgICAgICBzY3JlZW5zIGFzIFBhdGhDb25maWdNYXA8b2JqZWN0PixcbiAgICAgICAgICBbXSxcbiAgICAgICAgICBpbml0aWFsUm91dGVzLFxuICAgICAgICAgIFtdXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICAgLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIC8vIFNvcnQgY29uZmlnIHNvIHRoYXQ6XG4gICAgICAvLyAtIHRoZSBtb3N0IGV4aGF1c3RpdmUgb25lcyBhcmUgYWx3YXlzIGF0IHRoZSBiZWdpbm5pbmdcbiAgICAgIC8vIC0gcGF0dGVybnMgd2l0aCB3aWxkY2FyZCBhcmUgYWx3YXlzIGF0IHRoZSBlbmRcblxuICAgICAgLy8gSWYgMiBwYXR0ZXJucyBhcmUgc2FtZSwgbW92ZSB0aGUgb25lIHdpdGggbGVzcyByb3V0ZSBuYW1lcyB1cFxuICAgICAgLy8gVGhpcyBpcyBhbiBlcnJvciBzdGF0ZSwgc28gaXQncyBvbmx5IHVzZWZ1bCBmb3IgY29uc2lzdGVudCBlcnJvciBtZXNzYWdlc1xuICAgICAgaWYgKGEucGF0dGVybiA9PT0gYi5wYXR0ZXJuKSB7XG4gICAgICAgIHJldHVybiBiLnJvdXRlTmFtZXMuam9pbignPicpLmxvY2FsZUNvbXBhcmUoYS5yb3V0ZU5hbWVzLmpvaW4oJz4nKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIG9uZSBvZiB0aGUgcGF0dGVybnMgc3RhcnRzIHdpdGggdGhlIG90aGVyLCBpdCdzIG1vcmUgZXhoYXVzdGl2ZVxuICAgICAgLy8gU28gbW92ZSBpdCB1cFxuICAgICAgaWYgKGEucGF0dGVybi5zdGFydHNXaXRoKGIucGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuXG4gICAgICBpZiAoYi5wYXR0ZXJuLnN0YXJ0c1dpdGgoYS5wYXR0ZXJuKSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYVBhcnRzID0gYS5wYXR0ZXJuLnNwbGl0KCcvJyk7XG4gICAgICBjb25zdCBiUGFydHMgPSBiLnBhdHRlcm4uc3BsaXQoJy8nKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLm1heChhUGFydHMubGVuZ3RoLCBiUGFydHMubGVuZ3RoKTsgaSsrKSB7XG4gICAgICAgIC8vIGlmIGIgaXMgbG9uZ2VyLCBiIGdldCBoaWdoZXIgcHJpb3JpdHlcbiAgICAgICAgaWYgKGFQYXJ0c1tpXSA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgYSBpcyBsb25nZXIsIGEgZ2V0IGhpZ2hlciBwcmlvcml0eVxuICAgICAgICBpZiAoYlBhcnRzW2ldID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYVdpbGRDYXJkID0gYVBhcnRzW2ldID09PSAnKicgfHwgYVBhcnRzW2ldLnN0YXJ0c1dpdGgoJzonKTtcbiAgICAgICAgY29uc3QgYldpbGRDYXJkID0gYlBhcnRzW2ldID09PSAnKicgfHwgYlBhcnRzW2ldLnN0YXJ0c1dpdGgoJzonKTtcbiAgICAgICAgLy8gaWYgYm90aCBhcmUgd2lsZGNhcmQgd2UgY29tcGFyZSBuZXh0IGNvbXBvbmVudFxuICAgICAgICBpZiAoYVdpbGRDYXJkICYmIGJXaWxkQ2FyZCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIG9ubHkgYSBpcyB3aWxkIGNhcmQsIGIgZ2V0IGhpZ2hlciBwcmlvcml0eVxuICAgICAgICBpZiAoYVdpbGRDYXJkKSB7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgb25seSBiIGlzIHdpbGQgY2FyZCwgYSBnZXQgaGlnaGVyIHByaW9yaXR5XG4gICAgICAgIGlmIChiV2lsZENhcmQpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBiUGFydHMubGVuZ3RoIC0gYVBhcnRzLmxlbmd0aDtcbiAgICB9KTtcblxuICAvLyBDaGVjayBmb3IgZHVwbGljYXRlIHBhdHRlcm5zIGluIHRoZSBjb25maWdcbiAgY29uZmlncy5yZWR1Y2U8UmVjb3JkPHN0cmluZywgUm91dGVDb25maWc+PigoYWNjLCBjb25maWcpID0+IHtcbiAgICBpZiAoYWNjW2NvbmZpZy5wYXR0ZXJuXSkge1xuICAgICAgY29uc3QgYSA9IGFjY1tjb25maWcucGF0dGVybl0ucm91dGVOYW1lcztcbiAgICAgIGNvbnN0IGIgPSBjb25maWcucm91dGVOYW1lcztcblxuICAgICAgLy8gSXQncyBub3QgYSBwcm9ibGVtIGlmIHRoZSBwYXRoIHN0cmluZyBvbWl0dGVkIGZyb20gYSBpbm5lciBtb3N0IHNjcmVlblxuICAgICAgLy8gRm9yIGV4YW1wbGUsIGl0J3Mgb2sgaWYgYSBwYXRoIHJlc29sdmVzIHRvIGBBID4gQiA+IENgIG9yIGBBID4gQmBcbiAgICAgIGNvbnN0IGludGVyc2VjdHMgPVxuICAgICAgICBhLmxlbmd0aCA+IGIubGVuZ3RoXG4gICAgICAgICAgPyBiLmV2ZXJ5KChpdCwgaSkgPT4gYVtpXSA9PT0gaXQpXG4gICAgICAgICAgOiBhLmV2ZXJ5KChpdCwgaSkgPT4gYltpXSA9PT0gaXQpO1xuXG4gICAgICBpZiAoIWludGVyc2VjdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBGb3VuZCBjb25mbGljdGluZyBzY3JlZW5zIHdpdGggdGhlIHNhbWUgcGF0dGVybi4gVGhlIHBhdHRlcm4gJyR7XG4gICAgICAgICAgICBjb25maWcucGF0dGVyblxuICAgICAgICAgIH0nIHJlc29sdmVzIHRvIGJvdGggJyR7YS5qb2luKCcgPiAnKX0nIGFuZCAnJHtiLmpvaW4oXG4gICAgICAgICAgICAnID4gJ1xuICAgICAgICAgICl9Jy4gUGF0dGVybnMgbXVzdCBiZSB1bmlxdWUgYW5kIGNhbm5vdCByZXNvbHZlIHRvIG1vcmUgdGhhbiBvbmUgc2NyZWVuLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIHtcbiAgICAgIFtjb25maWcucGF0dGVybl06IGNvbmZpZyxcbiAgICB9KTtcbiAgfSwge30pO1xuXG4gIGlmIChyZW1haW5pbmcgPT09ICcvJykge1xuICAgIC8vIFdlIG5lZWQgdG8gYWRkIHNwZWNpYWwgaGFuZGxpbmcgb2YgZW1wdHkgcGF0aCBzbyBuYXZpZ2F0aW9uIHRvIGVtcHR5IHBhdGggYWxzbyB3b3Jrc1xuICAgIC8vIFdoZW4gaGFuZGxpbmcgZW1wdHkgcGF0aCwgd2Ugc2hvdWxkIG9ubHkgbG9vayBhdCB0aGUgcm9vdCBsZXZlbCBjb25maWdcbiAgICBjb25zdCBtYXRjaCA9IGNvbmZpZ3MuZmluZChcbiAgICAgIChjb25maWcpID0+XG4gICAgICAgIGNvbmZpZy5wYXRoID09PSAnJyAmJlxuICAgICAgICBjb25maWcucm91dGVOYW1lcy5ldmVyeShcbiAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhhdCBub25lIG9mIHRoZSBwYXJlbnQgY29uZmlncyBoYXZlIGEgbm9uLWVtcHR5IHBhdGggZGVmaW5lZFxuICAgICAgICAgIChuYW1lKSA9PiAhY29uZmlncy5maW5kKChjKSA9PiBjLnNjcmVlbiA9PT0gbmFtZSk/LnBhdGhcbiAgICAgICAgKVxuICAgICk7XG5cbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdChcbiAgICAgICAgcGF0aCxcbiAgICAgICAgbWF0Y2gucm91dGVOYW1lcy5tYXAoKG5hbWUpID0+ICh7IG5hbWUgfSkpLFxuICAgICAgICBpbml0aWFsUm91dGVzLFxuICAgICAgICBjb25maWdzXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBsZXQgcmVzdWx0OiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiB8IHVuZGVmaW5lZDtcbiAgbGV0IGN1cnJlbnQ6IFBhcnRpYWxTdGF0ZTxOYXZpZ2F0aW9uU3RhdGU+IHwgdW5kZWZpbmVkO1xuXG4gIC8vIFdlIG1hdGNoIHRoZSB3aG9sZSBwYXRoIGFnYWluc3QgdGhlIHJlZ2V4IGluc3RlYWQgb2Ygc2VnbWVudHNcbiAgLy8gVGhpcyBtYWtlcyBzdXJlIG1hdGNoZXMgc3VjaCBhcyB3aWxkY2FyZCB3aWxsIGNhdGNoIGFueSB1bm1hdGNoZWQgcm91dGVzLCBldmVuIGlmIG5lc3RlZFxuICBjb25zdCB7IHJvdXRlcywgcmVtYWluaW5nUGF0aCB9ID0gbWF0Y2hBZ2FpbnN0Q29uZmlncyhcbiAgICByZW1haW5pbmcsXG4gICAgY29uZmlncy5tYXAoKGMpID0+ICh7XG4gICAgICAuLi5jLFxuICAgICAgLy8gQWRkIGAkYCB0byB0aGUgcmVnZXggdG8gbWFrZSBzdXJlIGl0IG1hdGNoZXMgdGlsbCBlbmQgb2YgdGhlIHBhdGggYW5kIG5vdCBqdXN0IGJlZ2lubmluZ1xuICAgICAgcmVnZXg6IGMucmVnZXggPyBuZXcgUmVnRXhwKGMucmVnZXguc291cmNlICsgJyQnKSA6IHVuZGVmaW5lZCxcbiAgICB9KSlcbiAgKTtcblxuICBpZiAocm91dGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBUaGlzIHdpbGwgYWx3YXlzIGJlIGVtcHR5IGlmIGZ1bGwgcGF0aCBtYXRjaGVkXG4gICAgY3VycmVudCA9IGNyZWF0ZU5lc3RlZFN0YXRlT2JqZWN0KHBhdGgsIHJvdXRlcywgaW5pdGlhbFJvdXRlcywgY29uZmlncyk7XG4gICAgcmVtYWluaW5nID0gcmVtYWluaW5nUGF0aDtcbiAgICByZXN1bHQgPSBjdXJyZW50O1xuICB9XG5cbiAgaWYgKGN1cnJlbnQgPT0gbnVsbCB8fCByZXN1bHQgPT0gbnVsbCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5jb25zdCBqb2luUGF0aHMgPSAoLi4ucGF0aHM6IHN0cmluZ1tdKTogc3RyaW5nID0+XG4gIChbXSBhcyBzdHJpbmdbXSlcbiAgICAuY29uY2F0KC4uLnBhdGhzLm1hcCgocCkgPT4gcC5zcGxpdCgnLycpKSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgLmpvaW4oJy8nKTtcblxuY29uc3QgbWF0Y2hBZ2FpbnN0Q29uZmlncyA9IChyZW1haW5pbmc6IHN0cmluZywgY29uZmlnczogUm91dGVDb25maWdbXSkgPT4ge1xuICBsZXQgcm91dGVzOiBQYXJzZWRSb3V0ZVtdIHwgdW5kZWZpbmVkO1xuICBsZXQgcmVtYWluaW5nUGF0aCA9IHJlbWFpbmluZztcblxuICAvLyBHbyB0aHJvdWdoIGFsbCBjb25maWdzLCBhbmQgc2VlIGlmIHRoZSBuZXh0IHBhdGggc2VnbWVudCBtYXRjaGVzIG91ciByZWdleFxuICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBjb25maWdzKSB7XG4gICAgaWYgKCFjb25maWcucmVnZXgpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG1hdGNoID0gcmVtYWluaW5nUGF0aC5tYXRjaChjb25maWcucmVnZXgpO1xuXG4gICAgLy8gSWYgb3VyIHJlZ2V4IG1hdGNoZXMsIHdlIG5lZWQgdG8gZXh0cmFjdCBwYXJhbXMgZnJvbSB0aGUgcGF0aFxuICAgIGlmIChtYXRjaCkge1xuICAgICAgY29uc3QgbWF0Y2hlZFBhcmFtcyA9IGNvbmZpZy5wYXR0ZXJuXG4gICAgICAgID8uc3BsaXQoJy8nKVxuICAgICAgICAuZmlsdGVyKChwKSA9PiBwLnN0YXJ0c1dpdGgoJzonKSlcbiAgICAgICAgLnJlZHVjZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgICAgICAgICAoYWNjLCBwLCBpKSA9PlxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihhY2MsIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHBhcmFtIHNlZ21lbnRzIGFwcGVhciBldmVyeSBzZWNvbmQgaXRlbSBzdGFydGluZyBmcm9tIDIgaW4gdGhlIHJlZ2V4IG1hdGNoIHJlc3VsdFxuICAgICAgICAgICAgICBbcF06IG1hdGNoIVsoaSArIDEpICogMl0ucmVwbGFjZSgvXFwvLywgJycpLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAge31cbiAgICAgICAgKTtcblxuICAgICAgcm91dGVzID0gY29uZmlnLnJvdXRlTmFtZXMubWFwKChuYW1lKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGNvbmZpZ3MuZmluZCgoYykgPT4gYy5zY3JlZW4gPT09IG5hbWUpO1xuICAgICAgICBjb25zdCBwYXJhbXMgPSBjb25maWc/LnBhdGhcbiAgICAgICAgICA/LnNwbGl0KCcvJylcbiAgICAgICAgICAuZmlsdGVyKChwKSA9PiBwLnN0YXJ0c1dpdGgoJzonKSlcbiAgICAgICAgICAucmVkdWNlPFJlY29yZDxzdHJpbmcsIGFueT4+KChhY2MsIHApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWF0Y2hlZFBhcmFtc1twXTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGtleSA9IHAucmVwbGFjZSgvXjovLCAnJykucmVwbGFjZSgvXFw/JC8sICcnKTtcbiAgICAgICAgICAgICAgYWNjW2tleV0gPSBjb25maWcucGFyc2U/LltrZXldID8gY29uZmlnLnBhcnNlW2tleV0odmFsdWUpIDogdmFsdWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSwge30pO1xuXG4gICAgICAgIGlmIChwYXJhbXMgJiYgT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4geyBuYW1lLCBwYXJhbXMgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7IG5hbWUgfTtcbiAgICAgIH0pO1xuXG4gICAgICByZW1haW5pbmdQYXRoID0gcmVtYWluaW5nUGF0aC5yZXBsYWNlKG1hdGNoWzFdLCAnJyk7XG5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IHJvdXRlcywgcmVtYWluaW5nUGF0aCB9O1xufTtcblxuY29uc3QgY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MgPSAoXG4gIHNjcmVlbjogc3RyaW5nLFxuICByb3V0ZUNvbmZpZzogUGF0aENvbmZpZ01hcDxvYmplY3Q+LFxuICByb3V0ZU5hbWVzOiBzdHJpbmdbXSA9IFtdLFxuICBpbml0aWFsczogSW5pdGlhbFJvdXRlQ29uZmlnW10sXG4gIHBhcmVudFNjcmVlbnM6IHN0cmluZ1tdLFxuICBwYXJlbnRQYXR0ZXJuPzogc3RyaW5nXG4pOiBSb3V0ZUNvbmZpZ1tdID0+IHtcbiAgY29uc3QgY29uZmlnczogUm91dGVDb25maWdbXSA9IFtdO1xuXG4gIHJvdXRlTmFtZXMucHVzaChzY3JlZW4pO1xuXG4gIHBhcmVudFNjcmVlbnMucHVzaChzY3JlZW4pO1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3I6IHdlIGNhbid0IHN0cm9uZ2x5IHR5cGVjaGVjayB0aGlzIGZvciBub3dcbiAgY29uc3QgY29uZmlnID0gcm91dGVDb25maWdbc2NyZWVuXTtcblxuICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBJZiBhIHN0cmluZyBpcyBzcGVjaWZpZWQgYXMgdGhlIHZhbHVlIG9mIHRoZSBrZXkoZS5nLiBGb286ICcvcGF0aCcpLCB1c2UgaXQgYXMgdGhlIHBhdHRlcm5cbiAgICBjb25zdCBwYXR0ZXJuID0gcGFyZW50UGF0dGVybiA/IGpvaW5QYXRocyhwYXJlbnRQYXR0ZXJuLCBjb25maWcpIDogY29uZmlnO1xuXG4gICAgY29uZmlncy5wdXNoKGNyZWF0ZUNvbmZpZ0l0ZW0oc2NyZWVuLCByb3V0ZU5hbWVzLCBwYXR0ZXJuLCBjb25maWcpKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgY29uZmlnID09PSAnb2JqZWN0Jykge1xuICAgIGxldCBwYXR0ZXJuOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICAvLyBpZiBhbiBvYmplY3QgaXMgc3BlY2lmaWVkIGFzIHRoZSB2YWx1ZSAoZS5nLiBGb286IHsgLi4uIH0pLFxuICAgIC8vIGl0IGNhbiBoYXZlIGBwYXRoYCBwcm9wZXJ0eSBhbmRcbiAgICAvLyBpdCBjb3VsZCBoYXZlIGBzY3JlZW5zYCBwcm9wIHdoaWNoIGhhcyBuZXN0ZWQgY29uZmlnc1xuICAgIGlmICh0eXBlb2YgY29uZmlnLnBhdGggPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoY29uZmlnLmV4YWN0ICYmIGNvbmZpZy5wYXRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiQSAncGF0aCcgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIHdoZW4gc3BlY2lmeWluZyAnZXhhY3Q6IHRydWUnLiBJZiB5b3UgZG9uJ3Qgd2FudCB0aGlzIHNjcmVlbiBpbiB0aGUgVVJMLCBzcGVjaWZ5IGl0IGFzIGVtcHR5IHN0cmluZywgZS5nLiBgcGF0aDogJydgLlwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHBhdHRlcm4gPVxuICAgICAgICBjb25maWcuZXhhY3QgIT09IHRydWVcbiAgICAgICAgICA/IGpvaW5QYXRocyhwYXJlbnRQYXR0ZXJuIHx8ICcnLCBjb25maWcucGF0aCB8fCAnJylcbiAgICAgICAgICA6IGNvbmZpZy5wYXRoIHx8ICcnO1xuXG4gICAgICBjb25maWdzLnB1c2goXG4gICAgICAgIGNyZWF0ZUNvbmZpZ0l0ZW0oXG4gICAgICAgICAgc2NyZWVuLFxuICAgICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgICAgcGF0dGVybiEsXG4gICAgICAgICAgY29uZmlnLnBhdGgsXG4gICAgICAgICAgY29uZmlnLnBhcnNlXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5zY3JlZW5zKSB7XG4gICAgICAvLyBwcm9wZXJ0eSBgaW5pdGlhbFJvdXRlTmFtZWAgd2l0aG91dCBgc2NyZWVuc2AgaGFzIG5vIHB1cnBvc2VcbiAgICAgIGlmIChjb25maWcuaW5pdGlhbFJvdXRlTmFtZSkge1xuICAgICAgICBpbml0aWFscy5wdXNoKHtcbiAgICAgICAgICBpbml0aWFsUm91dGVOYW1lOiBjb25maWcuaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgICAgICBwYXJlbnRTY3JlZW5zLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgT2JqZWN0LmtleXMoY29uZmlnLnNjcmVlbnMpLmZvckVhY2goKG5lc3RlZENvbmZpZykgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjcmVhdGVOb3JtYWxpemVkQ29uZmlncyhcbiAgICAgICAgICBuZXN0ZWRDb25maWcsXG4gICAgICAgICAgY29uZmlnLnNjcmVlbnMgYXMgUGF0aENvbmZpZ01hcDxvYmplY3Q+LFxuICAgICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgICAgaW5pdGlhbHMsXG4gICAgICAgICAgWy4uLnBhcmVudFNjcmVlbnNdLFxuICAgICAgICAgIHBhdHRlcm4gPz8gcGFyZW50UGF0dGVyblxuICAgICAgICApO1xuXG4gICAgICAgIGNvbmZpZ3MucHVzaCguLi5yZXN1bHQpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcm91dGVOYW1lcy5wb3AoKTtcblxuICByZXR1cm4gY29uZmlncztcbn07XG5cbmNvbnN0IGNyZWF0ZUNvbmZpZ0l0ZW0gPSAoXG4gIHNjcmVlbjogc3RyaW5nLFxuICByb3V0ZU5hbWVzOiBzdHJpbmdbXSxcbiAgcGF0dGVybjogc3RyaW5nLFxuICBwYXRoOiBzdHJpbmcsXG4gIHBhcnNlPzogUGFyc2VDb25maWdcbik6IFJvdXRlQ29uZmlnID0+IHtcbiAgLy8gTm9ybWFsaXplIHBhdHRlcm4gdG8gcmVtb3ZlIGFueSBsZWFkaW5nLCB0cmFpbGluZyBzbGFzaGVzLCBkdXBsaWNhdGUgc2xhc2hlcyBldGMuXG4gIHBhdHRlcm4gPSBwYXR0ZXJuLnNwbGl0KCcvJykuZmlsdGVyKEJvb2xlYW4pLmpvaW4oJy8nKTtcblxuICBjb25zdCByZWdleCA9IHBhdHRlcm5cbiAgICA/IG5ldyBSZWdFeHAoXG4gICAgICAgIGBeKCR7cGF0dGVyblxuICAgICAgICAgIC5zcGxpdCgnLycpXG4gICAgICAgICAgLm1hcCgoaXQpID0+IHtcbiAgICAgICAgICAgIGlmIChpdC5zdGFydHNXaXRoKCc6JykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGAoKFteL10rXFxcXC8pJHtpdC5lbmRzV2l0aCgnPycpID8gJz8nIDogJyd9KWA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBgJHtpdCA9PT0gJyonID8gJy4qJyA6IGVzY2FwZShpdCl9XFxcXC9gO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmpvaW4oJycpfSlgXG4gICAgICApXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgcmV0dXJuIHtcbiAgICBzY3JlZW4sXG4gICAgcmVnZXgsXG4gICAgcGF0dGVybixcbiAgICBwYXRoLFxuICAgIC8vIFRoZSByb3V0ZU5hbWVzIGFycmF5IGlzIG11dGF0ZWQsIHNvIGNvcHkgaXQgdG8ga2VlcCB0aGUgY3VycmVudCBzdGF0ZVxuICAgIHJvdXRlTmFtZXM6IFsuLi5yb3V0ZU5hbWVzXSxcbiAgICBwYXJzZSxcbiAgfTtcbn07XG5cbmNvbnN0IGZpbmRQYXJzZUNvbmZpZ0ZvclJvdXRlID0gKFxuICByb3V0ZU5hbWU6IHN0cmluZyxcbiAgZmxhdENvbmZpZzogUm91dGVDb25maWdbXVxuKTogUGFyc2VDb25maWcgfCB1bmRlZmluZWQgPT4ge1xuICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBmbGF0Q29uZmlnKSB7XG4gICAgaWYgKHJvdXRlTmFtZSA9PT0gY29uZmlnLnJvdXRlTmFtZXNbY29uZmlnLnJvdXRlTmFtZXMubGVuZ3RoIC0gMV0pIHtcbiAgICAgIHJldHVybiBjb25maWcucGFyc2U7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbi8vIFRyeSB0byBmaW5kIGFuIGluaXRpYWwgcm91dGUgY29ubmVjdGVkIHdpdGggdGhlIG9uZSBwYXNzZWRcbmNvbnN0IGZpbmRJbml0aWFsUm91dGUgPSAoXG4gIHJvdXRlTmFtZTogc3RyaW5nLFxuICBwYXJlbnRTY3JlZW5zOiBzdHJpbmdbXSxcbiAgaW5pdGlhbFJvdXRlczogSW5pdGlhbFJvdXRlQ29uZmlnW11cbik6IHN0cmluZyB8IHVuZGVmaW5lZCA9PiB7XG4gIGZvciAoY29uc3QgY29uZmlnIG9mIGluaXRpYWxSb3V0ZXMpIHtcbiAgICBpZiAocGFyZW50U2NyZWVucy5sZW5ndGggPT09IGNvbmZpZy5wYXJlbnRTY3JlZW5zLmxlbmd0aCkge1xuICAgICAgbGV0IHNhbWVQYXJlbnRzID0gdHJ1ZTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyZW50U2NyZWVucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAocGFyZW50U2NyZWVuc1tpXS5sb2NhbGVDb21wYXJlKGNvbmZpZy5wYXJlbnRTY3JlZW5zW2ldKSAhPT0gMCkge1xuICAgICAgICAgIHNhbWVQYXJlbnRzID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzYW1lUGFyZW50cykge1xuICAgICAgICByZXR1cm4gcm91dGVOYW1lICE9PSBjb25maWcuaW5pdGlhbFJvdXRlTmFtZVxuICAgICAgICAgID8gY29uZmlnLmluaXRpYWxSb3V0ZU5hbWVcbiAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn07XG5cbi8vIHJldHVybnMgc3RhdGUgb2JqZWN0IHdpdGggdmFsdWVzIGRlcGVuZGluZyBvbiB3aGV0aGVyXG4vLyBpdCBpcyB0aGUgZW5kIG9mIHN0YXRlIGFuZCBpZiB0aGVyZSBpcyBpbml0aWFsUm91dGUgZm9yIHRoaXMgbGV2ZWxcbmNvbnN0IGNyZWF0ZVN0YXRlT2JqZWN0ID0gKFxuICBpbml0aWFsUm91dGU6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgcm91dGU6IFBhcnNlZFJvdXRlLFxuICBpc0VtcHR5OiBib29sZWFuXG4pOiBJbml0aWFsU3RhdGUgPT4ge1xuICBpZiAoaXNFbXB0eSkge1xuICAgIGlmIChpbml0aWFsUm91dGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGluZGV4OiAxLFxuICAgICAgICByb3V0ZXM6IFt7IG5hbWU6IGluaXRpYWxSb3V0ZSB9LCByb3V0ZV0sXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByb3V0ZXM6IFtyb3V0ZV0sXG4gICAgICB9O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAoaW5pdGlhbFJvdXRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbmRleDogMSxcbiAgICAgICAgcm91dGVzOiBbeyBuYW1lOiBpbml0aWFsUm91dGUgfSwgeyAuLi5yb3V0ZSwgc3RhdGU6IHsgcm91dGVzOiBbXSB9IH1dLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm91dGVzOiBbeyAuLi5yb3V0ZSwgc3RhdGU6IHsgcm91dGVzOiBbXSB9IH1dLFxuICAgICAgfTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IGNyZWF0ZU5lc3RlZFN0YXRlT2JqZWN0ID0gKFxuICBwYXRoOiBzdHJpbmcsXG4gIHJvdXRlczogUGFyc2VkUm91dGVbXSxcbiAgaW5pdGlhbFJvdXRlczogSW5pdGlhbFJvdXRlQ29uZmlnW10sXG4gIGZsYXRDb25maWc/OiBSb3V0ZUNvbmZpZ1tdXG4pID0+IHtcbiAgbGV0IHN0YXRlOiBJbml0aWFsU3RhdGU7XG4gIGxldCByb3V0ZSA9IHJvdXRlcy5zaGlmdCgpIGFzIFBhcnNlZFJvdXRlO1xuICBjb25zdCBwYXJlbnRTY3JlZW5zOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGxldCBpbml0aWFsUm91dGUgPSBmaW5kSW5pdGlhbFJvdXRlKHJvdXRlLm5hbWUsIHBhcmVudFNjcmVlbnMsIGluaXRpYWxSb3V0ZXMpO1xuXG4gIHBhcmVudFNjcmVlbnMucHVzaChyb3V0ZS5uYW1lKTtcblxuICBzdGF0ZSA9IGNyZWF0ZVN0YXRlT2JqZWN0KGluaXRpYWxSb3V0ZSwgcm91dGUsIHJvdXRlcy5sZW5ndGggPT09IDApO1xuXG4gIGlmIChyb3V0ZXMubGVuZ3RoID4gMCkge1xuICAgIGxldCBuZXN0ZWRTdGF0ZSA9IHN0YXRlO1xuXG4gICAgd2hpbGUgKChyb3V0ZSA9IHJvdXRlcy5zaGlmdCgpIGFzIFBhcnNlZFJvdXRlKSkge1xuICAgICAgaW5pdGlhbFJvdXRlID0gZmluZEluaXRpYWxSb3V0ZShyb3V0ZS5uYW1lLCBwYXJlbnRTY3JlZW5zLCBpbml0aWFsUm91dGVzKTtcblxuICAgICAgY29uc3QgbmVzdGVkU3RhdGVJbmRleCA9XG4gICAgICAgIG5lc3RlZFN0YXRlLmluZGV4IHx8IG5lc3RlZFN0YXRlLnJvdXRlcy5sZW5ndGggLSAxO1xuXG4gICAgICBuZXN0ZWRTdGF0ZS5yb3V0ZXNbbmVzdGVkU3RhdGVJbmRleF0uc3RhdGUgPSBjcmVhdGVTdGF0ZU9iamVjdChcbiAgICAgICAgaW5pdGlhbFJvdXRlLFxuICAgICAgICByb3V0ZSxcbiAgICAgICAgcm91dGVzLmxlbmd0aCA9PT0gMFxuICAgICAgKTtcblxuICAgICAgaWYgKHJvdXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG5lc3RlZFN0YXRlID0gbmVzdGVkU3RhdGUucm91dGVzW25lc3RlZFN0YXRlSW5kZXhdXG4gICAgICAgICAgLnN0YXRlIGFzIEluaXRpYWxTdGF0ZTtcbiAgICAgIH1cblxuICAgICAgcGFyZW50U2NyZWVucy5wdXNoKHJvdXRlLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHJvdXRlID0gZmluZEZvY3VzZWRSb3V0ZShzdGF0ZSkgYXMgUGFyc2VkUm91dGU7XG4gIHJvdXRlLnBhdGggPSBwYXRoO1xuXG4gIGNvbnN0IHBhcmFtcyA9IHBhcnNlUXVlcnlQYXJhbXMoXG4gICAgcGF0aCxcbiAgICBmbGF0Q29uZmlnID8gZmluZFBhcnNlQ29uZmlnRm9yUm91dGUocm91dGUubmFtZSwgZmxhdENvbmZpZykgOiB1bmRlZmluZWRcbiAgKTtcblxuICBpZiAocGFyYW1zKSB7XG4gICAgcm91dGUucGFyYW1zID0geyAuLi5yb3V0ZS5wYXJhbXMsIC4uLnBhcmFtcyB9O1xuICB9XG5cbiAgcmV0dXJuIHN0YXRlO1xufTtcblxuY29uc3QgcGFyc2VRdWVyeVBhcmFtcyA9IChcbiAgcGF0aDogc3RyaW5nLFxuICBwYXJzZUNvbmZpZz86IFJlY29yZDxzdHJpbmcsICh2YWx1ZTogc3RyaW5nKSA9PiBhbnk+XG4pID0+IHtcbiAgY29uc3QgcXVlcnkgPSBwYXRoLnNwbGl0KCc/JylbMV07XG4gIGNvbnN0IHBhcmFtcyA9IHF1ZXJ5U3RyaW5nLnBhcnNlKHF1ZXJ5KTtcblxuICBpZiAocGFyc2VDb25maWcpIHtcbiAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goKG5hbWUpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocGFyc2VDb25maWcsIG5hbWUpICYmXG4gICAgICAgIHR5cGVvZiBwYXJhbXNbbmFtZV0gPT09ICdzdHJpbmcnXG4gICAgICApIHtcbiAgICAgICAgcGFyYW1zW25hbWVdID0gcGFyc2VDb25maWdbbmFtZV0ocGFyYW1zW25hbWVdIGFzIHN0cmluZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGggPyBwYXJhbXMgOiB1bmRlZmluZWQ7XG59O1xuIl19